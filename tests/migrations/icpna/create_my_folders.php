<?php
/**
 * Creates a structure of subdirectories in the "My files" section of the
 * social network
 * @package chamilo.migration
 * @author Yannick Warnier
 */
/**
 * Init
 */
require __DIR__.'/../../../main/inc/global.inc.php';
// Array of directories structure
$dirs = array(
  'Adults_Program' => array(
    'Phase_1' => array(
      'B01-B04' => array(
        'B01' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B02' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B03' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B04' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'B05-B08' => array(
        'B05' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B06' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B07' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B08' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'B09-B12' => array(
        'B09' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B10' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B11' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'B12' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
    ),
    'Phase_2' => array(
      'I01-I04' => array(
        'I01' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I02' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I03' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I04' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'I05-B08' => array(
        'I05' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I06' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I07' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I08' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'I09-I12' => array(
        'I09' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I10' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I11' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'I12' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
    ),
    'Phase_3' => array(
      'A01M-A03M' => array(
        'A01M' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A02M' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A03M' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'A04F-A06F' => array(
        'A04F' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A05F' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A06F' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
      'A07W-A09W' => array(
        'A07W' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A08W' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
        'A09W' => array(
          'Unit_1' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_2' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
          'Unit_3' => array(
            'Lesson_A' => array(
            ),
            'Lesson_B' => array(
            ),
          ),
        ),
      ),
    ),
    'Methodology' => array(
      'MET1-MET3' => array(
        'MET1' => array(
        ),
        'MET2' => array(
        ),
        'MET3' => array(
        ),
      ),
      'MET4-MET6' => array(
        'MET4' => array(
        ),
        'MET5' => array(
        ),
        'MET6' => array(
        ),
      ),
    ),
  ),
  'YSP' => array(
    'Pre-Kinder_1-6' => array(
      'PKN01' => array(
        'Unit_1' => array(
        ),
      ),
      'PKN02' => array(
        'Unit_2' => array(
        ),
      ),
      'PKN03' => array(
        'Unit_3' => array(
        ),
      ),
      'PKN04' => array(
        'Unit_4' => array(
        ),
        'Unit_5' => array(
        ),
      ),
      'PKN05' => array(
        'Unit_6' => array(
        ),
        'Unit_7' => array(
        ),
      ),
      'PKN06' => array(
        'Unit_8' => array(
        ),
        'Unit_9' => array(
        ),
      ),
    ),
    'Kinder_1-6' => array(
      'KN01' => array(
        'Unit_1' => array(
        ),
      ),
      'KN02' => array(
        'Unit_2' => array(
        ),
      ),
      'KN03' => array(
        'Unit_3' => array(
        ),
      ),
      'KN04' => array(
        'Unit_4' => array(
        ),
        'Unit_5' => array(
        ),
      ),
      'KN05' => array(
        'Unit_6' => array(
        ),
        'Unit_7' => array(
        ),
      ),
      'KN06' => array(
        'Unit_8' => array(
        ),
        'Unit_9' => array(
        ),
      ),
    ),
    'Stage_1' => array(
      'Kids_1-6' => array(
        'K01' => array(
          'Unit_1' => array(
          ),
        ),
        'K02' => array(
          'Unit_2' => array(
          ),
        ),
        'K03' => array(
          'Unit_3' => array(
          ),
        ),
        'K04' => array(
          'Unit_4' => array(
          ),
          'Unit_5' => array(
          ),
        ),
        'K05' => array(
          'Unit_6' => array(
          ),
          'Unit_7' => array(
          ),
        ),
        'K06' => array(
          'Unit_8' => array(
          ),
          'Unit_9' => array(
          ),
        ),
      ),
      'Children_1-6' => array(
        'C01' => array(
          'Unit_1' => array(
          ),
        ),
        'C02' => array(
          'Unit_2' => array(
          ),
        ),
        'C03' => array(
          'Unit_3' => array(
          ),
        ),
        'C04' => array(
          'Unit_4' => array(
          ),
          'Unit_5' => array(
          ),
        ),
        'C05' => array(
          'Unit_6' => array(
          ),
          'Unit_7' => array(
          ),
        ),
        'C06' => array(
          'Unit_8' => array(
          ),
          'Unit_9' => array(
          ),
        ),
      ),
      'Young_Learners_1-6' => array(
        'Y01' => array(
          'Unit_1' => array(
          ),
        ),
        'Y02' => array(
          'Unit_2' => array(
          ),
        ),
        'Y03' => array(
          'Unit_3' => array(
          ),
        ),
        'Y04' => array(
          'Unit_4' => array(
          ),
          'Unit_5' => array(
          ),
        ),
        'Y05' => array(
          'Unit_6' => array(
          ),
          'Unit_7' => array(
          ),
        ),
        'Y06' => array(
          'Unit_8' => array(
          ),
          'Unit_9' => array(
          ),
        ),
      ),
    ),
    'Stage_2' => array(
      'Juniors_1-8' => array(
        'JR01' => array(
          'Unit_01' => array(
          ),
          'Unit_02' => array(
          ),
          'Unit_03' => array(
          ),
          'Unit_04' => array(
          ),
          'Unit_05' => array(
          ),
        ),
        'JR02' => array(
          'Unit_06' => array(
          ),
          'Unit_07' => array(
          ),
          'Unit_08' => array(
          ),
          'Unit_09' => array(
          ),
          'Unit_10' => array(
          ),
        ),
        'JR03' => array(
          'Unit_11' => array(
          ),
          'Unit_12' => array(
          ),
          'Unit_13' => array(
          ),
          'Unit_14' => array(
          ),
          'Unit_15' => array(
          ),
        ),
        'JR04' => array(
          'Unit_16' => array(
          ),
          'Unit_17' => array(
          ),
          'Unit_18' => array(
          ),
          'Unit_19' => array(
          ),
          'Unit_20' => array(
          ),
        ),
        'JR05' => array(
          'Unit_21' => array(
          ),
          'Unit_22' => array(
          ),
          'Unit_23' => array(
          ),
          'Unit_24' => array(
          ),
          'Unit_25' => array(
          ),
        ),
        'JR06' => array(
          'Unit_26' => array(
          ),
          'Unit_27' => array(
          ),
          'Unit_28' => array(
          ),
          'Unit_29' => array(
          ),
          'Unit_30' => array(
          ),
        ),
        'JR07' => array(
          'Unit_32' => array(
          ),
          'Unit_33' => array(
          ),
          'Unit_35' => array(
          ),
          'Unit_36' => array(
          ),
          'Unit_37' => array(
          ),
        ),
        'JR08' => array(
          'Unit_38' => array(
          ),
          'Unit_39' => array(
          ),
          'Unit_41' => array(
          ),
          'Unit_42' => array(
          ),
          'Unit_43' => array(
          ),
        ),
      ),
      'Pre-teens_1-8' => array(
        'PT01' => array(
          'Unit_01' => array(
          ),
          'Unit_02' => array(
          ),
          'Unit_03' => array(
          ),
          'Unit_04' => array(
          ),
          'Unit_05' => array(
          ),
        ),
        'PT02' => array(
          'Unit_06' => array(
          ),
          'Unit_07' => array(
          ),
          'Unit_08' => array(
          ),
          'Unit_09' => array(
          ),
          'Unit_10' => array(
          ),
        ),
        'PT03' => array(
          'Unit_11' => array(
          ),
          'Unit_12' => array(
          ),
          'Unit_13' => array(
          ),
          'Unit_14' => array(
          ),
          'Unit_15' => array(
          ),
        ),
        'PT04' => array(
          'Unit_16' => array(
          ),
          'Unit_17' => array(
          ),
          'Unit_18' => array(
          ),
          'Unit_19' => array(
          ),
          'Unit_20' => array(
          ),
        ),
        'PT05' => array(
          'Unit_21' => array(
          ),
          'Unit_22' => array(
          ),
          'Unit_23' => array(
          ),
          'Unit_24' => array(
          ),
          'Unit_25' => array(
          ),
        ),
        'PT06' => array(
          'Unit_26' => array(
          ),
          'Unit_27' => array(
          ),
          'Unit_28' => array(
          ),
          'Unit_29' => array(
          ),
          'Unit_30' => array(
          ),
        ),
        'PT07' => array(
          'Unit_31' => array(
          ),
          'Unit_32' => array(
          ),
          'Unit_33' => array(
          ),
          'Unit_34' => array(
          ),
          'Unit_35' => array(
          ),
        ),
        'PT08' => array(
          'Unit_36' => array(
          ),
          'Unit_37' => array(
          ),
          'Unit_38' => array(
          ),
          'Unit_39' => array(
          ),
          'Unit_40' => array(
          ),
        ),
      ),
      'Teens_1-8' => array(
        'T01' => array(
          'Unit_01' => array(
          ),
          'Unit_02' => array(
          ),
          'Unit_03' => array(
          ),
          'Unit_04' => array(
          ),
          'Unit_05' => array(
          ),
        ),
        'T02' => array(
          'Unit_06' => array(
          ),
          'Unit_07' => array(
          ),
          'Unit_08' => array(
          ),
          'Unit_09' => array(
          ),
          'Unit_10' => array(
          ),
        ),
        'T03' => array(
          'Unit_11' => array(
          ),
          'Unit_12' => array(
          ),
          'Unit_13' => array(
          ),
          'Unit_14' => array(
          ),
          'Unit_15' => array(
          ),
        ),
        'T04' => array(
          'Unit_16' => array(
          ),
          'Unit_17' => array(
          ),
          'Unit_18' => array(
          ),
          'Unit_19' => array(
          ),
          'Unit_20' => array(
          ),
        ),
        'T05' => array(
          'Unit_21' => array(
          ),
          'Unit_22' => array(
          ),
          'Unit_23' => array(
          ),
          'Unit_24' => array(
          ),
          'Unit_25' => array(
          ),
        ),
        'T06' => array(
          'Unit_26' => array(
          ),
          'Unit_27' => array(
          ),
          'Unit_28' => array(
          ),
          'Unit_29' => array(
          ),
          'Unit_30' => array(
          ),
        ),
        'T07' => array(
          'Unit_31' => array(
          ),
          'Unit_32' => array(
          ),
          'Unit_33' => array(
          ),
          'Unit_34' => array(
          ),
          'Unit_35' => array(
          ),
        ),
        'T08' => array(
          'Unit_36' => array(
          ),
          'Unit_37' => array(
          ),
          'Unit_38' => array(
          ),
          'Unit_39' => array(
          ),
          'Unit_40' => array(
          ),
        ),
      ),
    ),
  ),
);
$udir = api_get_path(SYS_CODE_PATH).'upload/users/';
/**
 * Process
 */
$users = get_teachers_ids();
echo count($users)."\n";
//$save_dir = getcwd();
//chdir($udir);
foreach ($users as $user) {
  if (!is_dir($udir.$user)) {
      mkdir($udir.$user);
      exec('chown www-data:www-data '.$udir.$user);
      if (!is_dir($udir.$user.'/my_files')) {
          mkdir($udir.$user.'/my_files');
          exec('chown www-data:www-data '.$udir.$user.'/my_files');
      }
  }
  create_structure($dirs, $udir.$user.'/my_files');
}
/**
 * Helper functions
 */
/**
 * Get teachers IDs from database
 */
function get_teachers_ids() {
    $sql = "SELECT user_id FROM user WHERE status = 1";
    $res = Database::query($sql);
    $list = array();
    while ($row = Database::fetch_assoc($res)) {
        $list[] = $row['user_id'];
    }
    return $list;
}
/**
 * Create subdirectories tree for given user ID using the given array/tree
 * @param array Directories folder
 * @param string User directory in which to create the directories
 * @return void
 */
function create_structure($tree, $userdir) {
    if (count($tree)>0) {
        foreach ($tree as $entry => $content) {
            if (is_dir($userdir.'/'.$entry)) {
                echo "Not creating $userdir/$entry\n";
            } else {
                echo "Creating $userdir/$entry\n";
                mkdir($userdir.'/'.$entry); 
                exec('chown www-data:www-data '.$userdir.'/'.$entry);
            }
            create_structure($content, $userdir.'/'.$entry);
        }
    }
    return null;
}
